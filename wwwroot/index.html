<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Subscription</title>
    <style>
        /* --- GENERAL --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 0;
        }

        h1, h2, h3 {
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* --- FORMS --- */
        input, select, button {
            padding: 8px 12px;
            margin: 6px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

            input:focus {
                outline: none;
                border-color: #007BFF;
                box-shadow: 0 0 3px rgba(0,123,255,0.5);
            }

        button {
            background-color: #007BFF;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }

            button:hover {
                background-color: #0056b3;
            }

        label {
            display: inline-block;
            margin-right: 10px;
            font-weight: 500;
        }

        section {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        /* --- TABLE --- */
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 12px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #007BFF;
            color: #fff;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #e3f2fd;
        }

        /* --- BUTTONS IN TABLE --- */
        .action-btn {
            margin-right: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

            .action-btn.increment {
                background-color: #28a745;
                color: #fff;
            }

            .action-btn.decrement {
                background-color: #ffc107;
                color: #fff;
            }

            .action-btn.delete {
                background-color: #dc3545;
                color: #fff;
            }

        /* --- LOGIN / REGISTER --- */
        #loginSection {
            margin-bottom: 30px;
        }

            #loginSection input {
                width: 180px;
            }

        #customerMenu input {
            width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Customer Subscription - Demo</h1>

        <!-- LOGIN / REGISTER -->
        <div id="loginSection">
            <h2>Login</h2>
            <label>Username: <input id="aUsername" /></label>
            <label>Password: <input id="aPassword" type="password" /></label>
            <button onclick="login()">Login</button>

            <h3>Register</h3>
            <label>Username: <input id="rUsername" /></label>
            <label>Password: <input id="rPassword" type="password" /></label>
            <button onclick="register()">Register</button>
        </div>

        <!-- CUSTOMER SUBSCRIPTION MENU -->
        <div id="customerMenu" style="display:none;">
            <h2>Customer Subscription</h2>

            <section>
                <h3>Query Subscriptions</h3>
                <label>Customer ID: <input id="qCustomerId" /></label>
                <label>Subscription Name: <input id="qSubscriptionName" /></label>
                <button onclick="querySubscriptions()">Search</button>
            </section>

            <section>
                <h3>Create Subscription</h3>
                <label>CustomerId: <input id="cCustomerId" /></label>
                <label>CustomerName: <input id="cCustomerName" /></label>
                <label>SubscriptionName: <input id="cSubscriptionName" /></label>
                <label>Count: <input id="cCount" type="number" value="0" /></label>
                <button onclick="createSubscription()">Create</button>
            </section>

            <section>
                <h3>Results</h3>
                <div id="results"></div>
            </section>

            <button onclick="logout()" style="margin-top:20px;">Logout</button>
        </div>
    </div>

    <script>
      
            const authBase = '/api/auth';
            const apiBase = '/api/CustomerSubscription';

            function getToken() {
                return localStorage.getItem('jwtToken');
            }

            // ===== REGISTER =====
            async function register() {
                const u = document.getElementById('rUsername').value.trim();
            const p = document.getElementById('rPassword').value.trim();
            if (!u || !p || p.length < 6) {alert('Username required, password min 6 chars'); return; }

            const res = await fetch(authBase + '/register', {
                method: 'POST',
            headers: {'Content-Type': 'application/json' },
            body: JSON.stringify({username: u, password: p })
                });
            if (res.ok) {alert('✅ Registered successfully'); }
            else {
                    const msg = await res.text();
            alert('❌ Register failed: ' + msg);
                }
            }

            // ===== LOGIN =====
            async function login() {
                const u = document.getElementById('aUsername').value.trim();
            const p = document.getElementById('aPassword').value.trim();
            if (!u || !p) {alert('Username and password required'); return; }

            const res = await fetch(authBase + '/login', {
                method: 'POST',
            headers: {'Content-Type': 'application/json' },
            body: JSON.stringify({username: u, password: p })
                });

            if (res.ok) {
                    const data = await res.json();
            localStorage.setItem('jwtToken', data.token);
            alert('✅ Login successful');
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('customerMenu').style.display = 'block';
            querySubscriptions();
                } else {
                    const msg = await res.text();
            alert('❌ Login failed: ' + msg);
                }
            }

            // ===== LOGOUT =====
            function logout() {
                localStorage.removeItem('jwtToken');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('customerMenu').style.display = 'none';
            document.getElementById('results').innerHTML = '';
            }

            // ===== QUERY SUBSCRIPTIONS =====
            async function querySubscriptions() {
                const token = getToken();
            if (!token) {alert('Login required'); return; }

            const customerId = document.getElementById('qCustomerId').value.trim();
            const sn = document.getElementById('qSubscriptionName').value.trim();
            if (!customerId) {alert('CustomerId is mandatory'); return; }

            const params = new URLSearchParams();
            params.append('CustomerId', customerId);
            if (sn) params.append('SubscriptionName', sn);

            const res = await fetch(apiBase + '?' + params.toString(), {
                headers: {'Authorization': 'Bearer ' + token }
                });
            if (res.ok) {
                    const data = await res.json();
            renderResults(data);
                } else {alert('❌ Failed to fetch subscriptions'); }
            }

            // ===== CREATE SUBSCRIPTION =====
            async function createSubscription() {
                const token = getToken();
            if (!token) {alert('Login required'); return; }

            const payload = {
                customerId: document.getElementById('cCustomerId').value.trim(),
            customerName: document.getElementById('cCustomerName').value.trim(),
            subscriptionName: document.getElementById('cSubscriptionName').value.trim(),
            subscriptionCount: parseInt(document.getElementById('cCount').value || '0'),
            isActive: true
                };
            if (!payload.customerId || !payload.customerName || !payload.subscriptionName) {
                alert('CustomerId, CustomerName and SubscriptionName required'); return;
                }

            const res = await fetch(apiBase, {
                method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
                    },
            body: JSON.stringify(payload)
                });

            if (res.status === 201) {alert('✅ Created'); querySubscriptions(); }
            else {alert('❌ Error creating subscription'); }
            }

            // ===== RENDER RESULTS =====
            function renderResults(items) {
                const container = document.getElementById('results');
            if (!items || items.length === 0) {container.innerHTML = '<p>No results</p>'; return; }

            let html = '<table><thead><tr><th>Id</th><th>CustomerId</th><th>CustomerName</th><th>SubscriptionName</th><th>Count</th><th>Active</th><th>Actions</th></tr></thead><tbody>';
                for (const it of items) {
                    html += `<tr>
                    <td>${it.id}</td>
                    <td>${it.customerId}</td>
                    <td>${it.customerName}</td>
                    <td>${it.subscriptionName}</td>
                    <td>${it.subscriptionCount}</td>
                    <td>${it.isActive}</td>
                    <td>
                        <button onclick="updateCount('${it.customerId}','${it.subscriptionName}',1)">+1</button>
                        <button onclick="updateCount('${it.customerId}','${it.subscriptionName}',-1)">-1</button>
                        <button onclick="deleteSub(${it.id})">Delete</button>
                    </td>
                </tr>`;
                }
                html += '</tbody></table>';
            container.innerHTML = html;
            }

            // ===== UPDATE COUNT =====
            async function updateCount(customerId, subscriptionName, delta) {
                const token = getToken();
            const res = await fetch(apiBase + '/update-count', {
                method: 'POST',
            headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
            body: JSON.stringify({customerId, subscriptionName, delta})
                });
            if (res.ok) {querySubscriptions(); } else {alert('❌ Update count failed'); }
            }

            // ===== DELETE SUBSCRIPTION =====
            async function deleteSub(id) {
                const token = getToken();
            if (!confirm('Delete subscription?')) return;

            const res = await fetch(apiBase + '/' + id, {
                method: 'DELETE',
            headers: {'Authorization': 'Bearer ' + token }
                });

            if (res.status === 204) {alert('✅ Deleted'); querySubscriptions(); }
            else {
                    const msg = await res.text();
            alert('❌ Delete failed: ' + msg);
                }
            }

    </script>
</body>
</html>


<!--<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Customer Subscription - Demo</title>
    <style>
        body { font-family: Arial; margin: 24px; }
        input, select { padding: 6px; margin: 4px }
        table { border-collapse: collapse; width: 100%; margin-top: 12px}
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left }
    </style>
</head>
<body>
    <h1>Customer Subscription - Demo</h1>

    <section>
        <h3>Auth</h3>
        <label>Username: <input id="aUsername"></label>
        <label>Password: <input id="aPassword" type="password"></label>
        <button onclick="register()">Register</button>
        <button onclick="login()">Login</button>
        <div id="tokenDiv"></div>
    </section>

    <section>
        <h3>Query Subscriptions</h3>
        <label>Customer ID: <input id="qCustomerId" /></label>
        <label>Subscription Name: <input id="qSubscriptionName" /></label>
        <button onclick="query()">Search</button>
    </section>

    <section>
        <h3>Create Subscription (requires login)</h3>
        <label>CustomerId: <input id="cCustomerId" /></label>
        <label>CustomerName: <input id="cCustomerName" /></label>
        <label>SubscriptionName: <input id="cSubscriptionName" /></label>
        <label>Count: <input id="cCount" type="number" value="0"/></label>
        <button onclick="create()">Create</button>
    </section>

    <section>
        <h3>Results</h3>
        <div id="results"></div>
    </section>

<script>
let token = null;
const apiBase = '/api/CustomerSubscription';
const authBase = '/api/Auth';

async function register(){
    const u = document.getElementById('aUsername').value.trim();
    const p = document.getElementById('aPassword').value.trim();

    if (!u) { alert('Username is required'); return; }
    if (!p || p.length < 6) { alert('Password must be at least 6 characters'); return; }

    const res = await fetch(authBase + '/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: u, password: p })
    });
    alert('Register status: ' + res.status);
}

async function login(){
    const u = document.getElementById('aUsername').value;
    const p = document.getElementById('aPassword').value;
    const res = await fetch(authBase + '/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({username:u,password:p})});
    const data = await res.json();
    if(res.ok){ token = data.token; document.getElementById('tokenDiv').innerText = 'Token set'; } else { alert(data.message || 'Login failed'); }
}

async function query() {
  const customerId = document.getElementById('qCustomerId').value;
  if (!customerId) { alert('CustomerId is mandatory'); return; }
  const params = new URLSearchParams();
  params.append('CustomerId', customerId);
  const sn = document.getElementById('qSubscriptionName').value;
  if (sn) params.append('SubscriptionName', sn);

  const res = await fetch(apiBase + '?' + params.toString());
  const data = await res.json();
  renderResults(data);
}

function renderResults(items) {
  const container = document.getElementById('results');
  if (!items || items.length === 0) { container.innerHTML = '<p>No results</p>'; return; }
  let html = '<table><thead><tr><th>Id</th><th>CustomerId</th><th>CustomerName</th><th>SubscriptionName</th><th>Count</th><th>Actions</th></tr></thead><tbody>';
  for (const it of items) {
    html += `<tr>
      <td>${it.id}</td>
      <td>${it.customerId}</td>
      <td>${it.customerName}</td>
      <td>${it.subscriptionName}</td>
      <td>${it.subscriptionCount}</td>
      <td>
        <button onclick="updateCount('${it.customerId}','${it.subscriptionName}',1)">+1</button>
        <button onclick="updateCount('${it.customerId}','${it.subscriptionName}',-1)">-1</button>
      </td>
    </tr>`;
  }
  html += '</tbody></table>';
  container.innerHTML = html;
}

async function create(){
    if(!token){ alert('login required'); return; }
    const payload = {
        customerId: document.getElementById('cCustomerId').value,
        customerName: document.getElementById('cCustomerName').value,
        subscriptionName: document.getElementById('cSubscriptionName').value,
        subscriptionCount: parseInt(document.getElementById('cCount').value||'0'),
        startDate: null,
        endDate: null,
        isActive: true
    };
    const res = await fetch(apiBase, { method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+token}, body: JSON.stringify(payload) });
    if(res.status===201){ alert('Created'); query(); } else { alert('Create failed'); }
}

async function updateCount(customerId, subscriptionName, delta){
    const res = await fetch('/api/CustomerSubscription/update-count', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ customerId, subscriptionName, delta })});
    if(res.ok) query(); else alert('Update failed');
}
</script>
</body>
</html>-->
